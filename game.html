<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Coco Clan: Kingdom Rise</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Poppins', sans-serif; }
        canvas { display: block; background: #2d5a27; }

        /* UI Styling */
        #ui { position: fixed; top: 0; left: 0; width: 100%; pointer-events: none; }
        .stats-bar { display: flex; justify-content: space-around; background: rgba(0,0,0,0.8); padding: 10px; color: #f1c40f; font-size: 12px; pointer-events: all; border-bottom: 3px solid #f1c40f; }
        
        .build-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; background: rgba(0,0,0,0.9); padding: 15px; border-radius: 20px; border: 2px solid #f1c40f; pointer-events: all; }
        .slot { width: 60px; text-align: center; cursor: pointer; color: #fff; font-size: 8px; transition: 0.2s; }
        .slot:hover { transform: scale(1.1); color: #f1c40f; }
        .slot img { width: 40px; height: 40px; display: block; margin: 0 auto; }

        #msg { position: fixed; top: 80px; width: 100%; text-align: center; color: #fff; text-shadow: 2px 2px #000; font-weight: bold; pointer-events: none; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stats-bar">
        <span>üå≤ Wood: <b id="wood">0</b></span>
        <span>ü™® Stone: <b id="stone">0</b></span>
        <span>üíé Gem: <b id="gem">0</b></span>
        <span>‚öîÔ∏è Troops: <b id="troops">0</b></span>
    </div>
    <div id="msg">üå≤ Cut trees or mine stones to start building!</div>
</div>

<div class="build-bar">
    <div class="slot" onclick="setBuild('house', 5, 2, 0)">
        <img src="https://cdn-icons-png.flaticon.com/512/619/619153.png">House(5W,2S)
    </div>
    <div class="slot" onclick="setBuild('barracks', 10, 5, 5)">
        <img src="https://cdn-icons-png.flaticon.com/512/1063/1063181.png">Barracks
    </div>
    <div class="slot" onclick="setBuild('mine', 15, 10, 0)">
        <img src="https://cdn-icons-png.flaticon.com/512/1239/1239608.png">Gem Mine
    </div>
</div>

<canvas id="game"></canvas>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let res = { wood: 10, stone: 10, gem: 0, troops: 0 };
    let player = { x: canvas.width/2, y: canvas.height/2, size: 20, speed: 3 };
    let trees = [], rocks = [], buildings = [];
    let selectedBuild = null;

    // --- Sound System ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSfx(freq, type) {
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.type = type; osc.frequency.value = freq;
        g.gain.setValueAtTime(0.1, audioCtx.currentTime);
        osc.connect(g); g.connect(audioCtx.destination);
        osc.start(); g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        osc.stop(audioCtx.currentTime + 0.1);
    }

    // --- Init Objects ---
    for(let i=0; i<15; i++) {
        trees.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, hp: 3 });
        rocks.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, hp: 5 });
    }

    function setBuild(type, w, s, g) {
        selectedBuild = { type, w, s, g };
        document.getElementById('msg').innerText = `Place your ${type} on the map!`;
    }

    canvas.addEventListener('click', (e) => {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        
        // 1. Build Logic
        if(selectedBuild) {
            if(res.wood >= selectedBuild.w && res.stone >= selectedBuild.s) {
                res.wood -= selectedBuild.w; res.stone -= selectedBuild.s;
                buildings.push({ x: e.clientX, y: e.clientY, type: selectedBuild.type, lvl: 1 });
                playSfx(400, 'sine');
                selectedBuild = null;
                document.getElementById('msg').innerText = "Structure Built!";
            } else {
                document.getElementById('msg').innerText = "Need more resources!";
            }
            return;
        }

        // 2. Interaction Logic (Chop/Mine)
        trees.forEach((t, i) => {
            if(Math.hypot(e.clientX-t.x, e.clientY-t.y) < 40) {
                t.hp--; playSfx(150, 'square');
                if(t.hp <= 0) { res.wood += 5; trees.splice(i, 1); }
            }
        });
        rocks.forEach((r, i) => {
            if(Math.hypot(e.clientX-r.x, e.clientY-r.y) < 40) {
                r.hp--; playSfx(300, 'sawtooth');
                if(r.hp <= 0) { res.stone += 3; rocks.splice(i, 1); }
            }
        });
    });

    function draw() {
        ctx.clearRect(0,0,canvas.width, canvas.height);
        
        // Draw Grass/Forest background
        ctx.fillStyle = "#2d5a27"; ctx.fillRect(0,0,canvas.width, canvas.height);

        // Draw Trees
        trees.forEach(t => {
            ctx.fillStyle = "#1b3310"; ctx.beginPath(); ctx.arc(t.x, t.y, 15, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = "#5d4037"; ctx.fillRect(t.x-5, t.y, 10, 20);
        });

        // Draw Rocks
        rocks.forEach(r => {
            ctx.fillStyle = "#757575"; ctx.beginPath(); ctx.arc(r.x, r.y, 12, 0, Math.PI*2); ctx.fill();
        });

        // Draw Buildings
        buildings.forEach(b => {
            ctx.fillStyle = b.type === 'house' ? '#a52a2a' : '#4682b4';
            ctx.fillRect(b.x-25, b.y-25, 50, 50);
            ctx.fillStyle = "#fff"; ctx.font = "8px Arial";
            ctx.fillText(`${b.type.toUpperCase()} LVL:${b.lvl}`, b.x-20, b.y+5);
        });

        // Draw Player (Small Soldier)
        ctx.fillStyle = "#f1c40f"; ctx.beginPath(); ctx.arc(player.x, player.y, player.size, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = "#000"; ctx.beginPath(); ctx.arc(player.x-5, player.y-5, 2, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(player.x+5, player.y-5, 2, 0, Math.PI*2); ctx.fill();

        // Update Stats UI
        document.getElementById('wood').innerText = res.wood;
        document.getElementById('stone').innerText = res.stone;
        document.getElementById('gem').innerText = res.gem;
        document.getElementById('troops').innerText = res.troops;

        requestAnimationFrame(draw);
    }

    draw();
</script>
</body>
</html>
